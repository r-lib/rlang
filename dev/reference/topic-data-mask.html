<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>What is data-masking and why do I need {{? — topic-data-mask • rlang</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="What is data-masking and why do I need {{? — topic-data-mask"><meta name="description" content="Data-masking is a distinctive feature of R whereby programming is performed directly on a data set, with columns defined as normal objects.
# Unmasked programming
mean(mtcars$cyl + mtcars$am)
#&amp;gt; [1] 6.59375

# Referring to columns is an error - Where is the data?
mean(cyl + am)
#&amp;gt; Error:
#&amp;gt; ! object 'cyl' not found

# Data-masking
with(mtcars, mean(cyl + am))
#&amp;gt; [1] 6.59375

While data-masking makes it easy to program interactively with data frames, it makes it harder to create functions. Passing data-masked arguments to functions requires injection with the embracing operator {{ or, in more complex cases, the injection operator !!."><meta property="og:description" content="Data-masking is a distinctive feature of R whereby programming is performed directly on a data set, with columns defined as normal objects.
# Unmasked programming
mean(mtcars$cyl + mtcars$am)
#&amp;gt; [1] 6.59375

# Referring to columns is an error - Where is the data?
mean(cyl + am)
#&amp;gt; Error:
#&amp;gt; ! object 'cyl' not found

# Data-masking
with(mtcars, mean(cyl + am))
#&amp;gt; [1] 6.59375

While data-masking makes it easy to program interactively with data frames, it makes it harder to create functions. Passing data-masked arguments to functions requires injection with the embracing operator {{ or, in more complex cases, the injection operator !!."><meta property="og:image" content="https://rlang.r-lib.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="rlang.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rlang</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.6.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tidy-evaluation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tidy evaluation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tidy-evaluation"><li><h6 class="dropdown-header" data-toc-skip>Overviews</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-data-mask.html">What is data-masking and why do I need `{{`?</a></li>
    <li><a class="dropdown-item" href="../reference/topic-data-mask-programming.html">Data mask programming patterns</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-data-mask-ambiguity.html">The data mask ambiguity</a></li>
    <li><a class="dropdown-item" href="../reference/topic-double-evaluation.html">The double evaluation problem</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Notes</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-inject-out-of-context.html">What happens if I use injection operators out of context?</a></li>
    <li><a class="dropdown-item" href="../reference/topic-embrace-non-args.html">Does `{{` work on regular objects?</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-metaprogramming" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Metaprogramming</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-metaprogramming"><li><h6 class="dropdown-header" data-toc-skip>Overviews</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-defuse.html">Defusing R expressions</a></li>
    <li><a class="dropdown-item" href="../reference/topic-inject.html">Injecting with `!!`, `!!!`, and glue syntax</a></li>
    <li><a class="dropdown-item" href="../reference/topic-metaprogramming.html">Metaprogramming patterns</a></li>
    <li><a class="dropdown-item" href="../reference/topic-quosure.html">What are quosures and when are they needed?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-multiple-columns.html">Taking multiple columns without `...`</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Notes</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-embrace-constants.html">Why are strings and other constants enquosed in the empty environment?</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-conditions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Conditions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-conditions"><li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-error-call.html">Including function calls in error messages</a></li>
    <li><a class="dropdown-item" href="../reference/topic-error-chaining.html">Including contextual information with error chains</a></li>
    <li><a class="dropdown-item" href="../reference/topic-condition-formatting.html">Formatting messages with cli</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Notes</h6></li>
    <li><a class="dropdown-item" href="../reference/topic-condition-customisation.html">Customising condition messages</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/rlang/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>What is data-masking and why do I need <code>{{</code>?</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/rlang/blob/main/R/topic-nse.R" class="external-link"><code>R/topic-nse.R</code></a></small>
      <div class="d-none name"><code>topic-data-mask.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Data-masking is a distinctive feature of R whereby programming is performed directly on a data set, with columns defined as normal objects.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Unmasked programming</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span> <span class="op">+</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">am</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.59375</span></span>
<span></span>
<span><span class="co"># Referring to columns is an error - Where is the data?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op">+</span> <span class="va">am</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error:</span></span>
<span><span class="co">#&gt; ! object 'cyl' not found</span></span>
<span></span>
<span><span class="co"># Data-masking</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op">+</span> <span class="va">am</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.59375</span></span></code></pre><p></p></div>
<p>While data-masking makes it easy to program interactively with data frames, it makes it harder to create functions. Passing data-masked arguments to functions requires injection with the embracing operator <code><a href="embrace-operator.html">{{</a></code> or, in more complex cases, the injection operator <code><a href="injection-operator.html">!!</a></code>.</p>
    </div>


    <div class="section level2">
    <h2 id="why-does-data-masking-require-embracing-and-injection-">Why does data-masking require embracing and injection?<a class="anchor" aria-label="anchor" href="#why-does-data-masking-require-embracing-and-injection-"></a></h2>
    <p>Injection (also known as quasiquotation) is a metaprogramming feature that allows you to modify parts of a program. This is needed because under the hood data-masking works by <a href="topic-defuse.html">defusing</a> R code to prevent its immediate evaluation. The defused code is resumed later on in a context where data frame columns are defined.</p>
<p>Let's see what happens when we pass arguments to a data-masking function like <code>summarise()</code> in the normal way:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">var1</span> <span class="op">+</span> <span class="va">var2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">my_mean</span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">cyl</span>, <span class="va">am</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `dplyr::summarise()`:</span></span>
<span><span class="co">#&gt; i In argument: `mean(var1 + var2)`.</span></span>
<span><span class="co">#&gt; Caused by error:</span></span>
<span><span class="co">#&gt; ! object 'cyl' not found</span></span></code></pre><p></p></div>
<p>The problem here is that <code>summarise()</code> defuses the R code it was supplied, i.e. <code>mean(var1 + var2)</code>.  Instead we want it to see <code>mean(cyl + am)</code>. This is why we need injection, we need to modify that piece of code by injecting the code supplied to the function in place of <code>var1</code> and <code>var2</code>.</p>
<p>To inject a function argument in data-masked context, just embrace it with <code>{{</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">var1</span> <span class="op">}</span><span class="op">}</span> <span class="op">+</span> <span class="op">{</span><span class="op">{</span> <span class="va">var2</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">my_mean</span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">cyl</span>, <span class="va">am</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 1</span></span>
<span><span class="co">#&gt;   `mean(cyl + am)`</span></span>
<span><span class="co">#&gt;              &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             6.59</span></span></code></pre><p></p></div>
<p>See <a href="topic-data-mask-programming.html">Data mask programming patterns</a> to learn more about creating functions around data-masking functions.</p>
    </div>
    <div class="section level2">
    <h2 id="what-does-masking-mean-">What does "masking" mean?<a class="anchor" aria-label="anchor" href="#what-does-masking-mean-"></a></h2>
    <p>In normal R programming objects are defined in the current environment, for instance in the global environment or the environment of a function.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">factor</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Can now use `factor` in computations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span> <span class="op">*</span> <span class="va">factor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6187.5</span></span></code></pre><p></p></div>
<p>This environment also contains all functions currently in scope. In a script this includes the functions attached with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> calls; in a package, the functions imported from other packages. If evaluation was performed only in the data frame, we'd lose track of these objects and functions necessary to perform computations.</p>
<p>To keep these objects and functions in scope, the data frame is inserted at the bottom of the current chain of environments. It comes first and has precedence over the user environment. In other words, it <em>masks</em> the user environment.</p>
<p>Since masking blends the data and the user environment by giving priority to the former, R can sometimes use a data frame column when you really intended to use a local object.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Defining an env-variable</span></span>
<span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Referring to a data-variable</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 1</span></span>
<span><span class="co">#&gt;   `mean(cyl)`</span></span>
<span><span class="co">#&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1        6.19</span></span></code></pre><p></p></div>
<p>The tidy eval framework provides <a href="dot-data.html">pronouns</a> to help disambiguate between the mask and user contexts. It is often a good idea to use these pronouns in production code.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">mtcars</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    mean_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span>,</span>
<span>    mean_env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.env</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span><span class="co">#&gt;   mean_data mean_env</span></span>
<span><span class="co">#&gt;       &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1      6.19     1000</span></span></code></pre><p></p></div>
<p>Read more about this in <a href="topic-data-mask-ambiguity.html">The data mask ambiguity</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="how-does-data-masking-work-">How does data-masking work?<a class="anchor" aria-label="anchor" href="#how-does-data-masking-work-"></a></h2>
    <p>Data-masking relies on three language features:</p><ul><li><p><a href="topic-defuse.html">Argument defusal</a> with <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute()</a></code> (base R) or <code><a href="enquo.html">enquo()</a></code>, <code><a href="enquo.html">enquos()</a></code>, and <code><a href="embrace-operator.html">{{</a></code> (rlang). R code is defused so it can be evaluated later on in a special environment enriched with data.</p></li>
<li><p>First class environments. Environments are a special type of list-like object in which defused R code can be evaluated.  The named elements in an environment define objects. Lists and data frames can be transformed to environments:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/as.environment.html" class="external-link">as.environment</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x7febb17e3468&gt;</span></span></code></pre><p></p></div></li>
<li><p>Explicit evaluation with <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code> (base) or <code><a href="eval_tidy.html">eval_tidy()</a></code> (rlang). When R code is defused, evaluation is interrupted. It can be resumed later on with <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/expr.html">expr</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 + 1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="../reference/expr.html">expr</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre><p></p></div>
<p>By default <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code> and <code><a href="eval_tidy.html">eval_tidy()</a></code> evaluate in the current environment.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expr.html">expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op">+</span> <span class="va">am</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error:</span></span>
<span><span class="co">#&gt; ! object 'am' not found</span></span></code></pre><p></p></div>
<p>You can supply an optional list or data frame that will be converted to an environment.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.59375</span></span></code></pre><p></p></div>
<p>Evaluation of defused code then occurs in the context of a data mask.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="history">History<a class="anchor" aria-label="anchor" href="#history"></a></h2>
    <p>The tidyverse embraced the data-masking approach in packages like ggplot2 and dplyr and eventually developed its own programming framework in the rlang package. None of this would have been possible without the following landmark developments from S and R authors.</p><ul><li><p>The S language introduced data scopes with <code><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach()</a></code> (Becker, Chambers and Wilks, The New S Language, 1988).</p></li>
<li><p>The S language introduced data-masked formulas in modelling functions (Chambers and Hastie, 1993).</p></li>
<li><p>Peter Dalgaard (R team) wrote the frametools package in 1997. It was later included in R as <code><a href="https://rdrr.io/r/base/transform.html" class="external-link">base::transform()</a></code> and <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">base::subset()</a></code>. This API is an important source of inspiration for the dplyr package. It was also the first apparition of <em>selections</em>, a variant of data-masking extended and codified later on in the <a href="https://tidyselect.r-lib.org/articles/syntax.html" class="external-link">tidyselect package</a>.</p></li>
<li><p>In 2000 Luke Tierney (R team) <a href="https://github.com/wch/r-source/commit/a945ac8e" class="external-link">changed formulas</a> to keep track of their original environments. This change published in R 1.1.0 was a crucial step towards hygienic data masking, i.e. the proper resolution of symbols in their original environments. Quosures were inspired by the environment-tracking mechanism of formulas.</p></li>
<li><p>Luke introduced <code><a href="https://rdrr.io/r/base/with.html" class="external-link">base::with()</a></code> in 2001.</p></li>
<li><p>In 2006 the <a href="https://r-datatable.com" class="external-link">data.table package</a> included data-masking and selections in the <code>i</code> and <code>j</code> arguments of the <code>[</code> method of a data frame.</p></li>
<li><p>The <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr package</a> was published in 2014.</p></li>
<li><p>The rlang package developed tidy eval in 2017 as the data-masking framework of the tidyverse. It introduced the notions of <a href="topic-quosure.html">quosure</a>, <a href="topic-inject.html">implicit injection</a> with <code>!!</code>  and <code>!!!</code>, and <a href="dot-data.html">data pronouns</a>.</p></li>
<li><p>In 2019, injection with <code>{{</code> was introduced in <a href="https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/" class="external-link">rlang 0.4.0</a> to simplify the defuse-and-inject pattern. This operator allows R programmers to transport data-masked arguments across functions more intuitively and with minimal boilerplate.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>

<ul><li><p><a href="topic-data-mask-programming.html">Data mask programming patterns</a></p></li>
<li><p><a href="topic-defuse.html">Defusing R expressions</a></p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

