<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Force parts of an expression — nse-force • rlang</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Force parts of an expression — nse-force" />
<meta property="og:description" content="It is sometimes useful to force early evaluation of part of an
expression before it gets fully evaluated. The tidy eval framework
provides several forcing operators for different use cases.
The bang-bang operator !! forces a single object. One
common case for !! is to substitute an environment-variable
(created with &amp;lt;-) with a data-variable (inside a data frame).library(dplyr)

# The environment variable `var` refers to the data-variable
# `height`
var &amp;lt;- sym(&quot;height&quot;)

# We force `var`, which substitutes it with `height`
starwars %&amp;gt;%
  summarise(avg = mean(!!var, na.rm = TRUE))

The big-bang operator !!! forces-splice a list of objects.
The elements of the list are spliced in place, meaning that they
each become one single argument.vars &amp;lt;- syms(c(&quot;height&quot;, &quot;mass&quot;))

# Force-splicing is equivalent to supplying the elements separately
starwars %&amp;gt;% select(!!!vars)
starwars %&amp;gt;% select(height, mass)

The curly-curly operator {{ }} for function arguments is a bit
special because it forces the function argument and immediately
defuses it. The defused expression is substituted in place, ready
to be evaluated in another context, such as the data frame.
In practice, this is useful when you have a data-variable in an
env-variable (such as a function argument).# Force-defuse all function arguments that might contain
# data-variables by embracing them with {{ }}
mean_by &amp;lt;- function(data, by, var) {
  data %&amp;gt;%
    group_by({{ by }}) %&amp;gt;%
    summarise(avg = mean({{ var }}, na.rm = TRUE))
}

# The env-variables `by` and `var` are forced but defused.
# The data-variables they contain are evaluated by dplyr later on
# in data context.
iris %&amp;gt;% mean_by(by = Species, var = Sepal.Width)



Use qq_show() to experiment with forcing operators. qq_show()
defuses its input, processes all forcing operators, and prints the
result with expr_print() to reveal objects inlined in the
expression by the forcing operators." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rlang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Life cycle</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Force parts of an expression</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/rlang/blob/master/R/nse-force.R'><code>R/nse-force.R</code></a></small>
    <div class="hidden name"><code>nse-force.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>It is sometimes useful to force early evaluation of part of an
expression before it gets fully evaluated. The tidy eval framework
provides several forcing operators for different use cases.</p><ul>
<li><p>The bang-bang operator <code>!!</code> forces a <em>single</em> object. One
common case for <code>!!</code> is to substitute an environment-variable
(created with <code>&lt;-</code>) with a data-variable (inside a data frame).</p><pre><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>dplyr</span><span class='op'>)</span>

<span class='co'># The environment variable `var` refers to the data-variable</span>
<span class='co'># `height`</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span><span class='op'>(</span><span class='st'>"height"</span><span class='op'>)</span>

<span class='co'># We force `var`, which substitutes it with `height`</span>
<span class='va'>starwars</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>avg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>var</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</pre></li>
<li><p>The big-bang operator <code>!!!</code> forces-splice a <em>list</em> of objects.
The elements of the list are spliced in place, meaning that they
each become one single argument.</p><pre><span class='va'>vars</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sym.html'>syms</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"height"</span>, <span class='st'>"mass"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Force-splicing is equivalent to supplying the elements separately</span>
<span class='va'>starwars</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>!</span><span class='va'>vars</span><span class='op'>)</span>
<span class='va'>starwars</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='va'>height</span>, <span class='va'>mass</span><span class='op'>)</span>
</pre></li>
<li><p>The curly-curly operator <code>{{ }}</code> for function arguments is a bit
special because it forces the function argument and immediately
defuses it. The defused expression is substituted in place, ready
to be evaluated in another context, such as the data frame.</p>
<p>In practice, this is useful when you have a data-variable in an
env-variable (such as a function argument).</p><pre><span class='co'># Force-defuse all function arguments that might contain</span>
<span class='co'># data-variables by embracing them with {{ }}</span>
<span class='va'>mean_by</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>by</span>, <span class='va'>var</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>data</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span> <span class='va'>by</span> <span class='op'>}</span><span class='op'>}</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>summarise</span><span class='op'>(</span>avg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span> <span class='va'>var</span> <span class='op'>}</span><span class='op'>}</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># The env-variables `by` and `var` are forced but defused.</span>
<span class='co'># The data-variables they contain are evaluated by dplyr later on</span>
<span class='co'># in data context.</span>
<span class='va'>iris</span> <span class='op'>%&gt;%</span> <span class='fu'>mean_by</span><span class='op'>(</span>by <span class='op'>=</span> <span class='va'>Species</span>, var <span class='op'>=</span> <span class='va'>Sepal.Width</span><span class='op'>)</span>
</pre></li>
</ul>

<p>Use <code>qq_show()</code> to experiment with forcing operators. <code>qq_show()</code>
defuses its input, processes all forcing operators, and prints the
result with <code><a href='expr_print.html'>expr_print()</a></code> to reveal objects inlined in the
expression by the forcing operators.</p>
    </div>

    <pre class="usage"><span class='fu'>qq_show</span><span class='op'>(</span><span class='va'>expr</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>An expression to be quasiquoted.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="forcing-names"><a class="anchor" href="#forcing-names"></a>Forcing names</h2>

    


<p>When a function takes multiple named arguments
(e.g. <code>dplyr::mutate()</code>), it is difficult to supply a variable as
name. Since the LHS of <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code> is <a href='nse-defuse.html'>defused</a>, giving the name
of a variable results in the argument having the name of the
variable rather than the name stored in that variable. This problem
of forcing evaluation of names is exactly what the <code>!!</code> operator is
for.</p>
<p>Unfortunately R is very strict about the kind of expressions
supported on the LHS of <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code>. This is why rlang interprets the
walrus operator <code>:=</code> as an alias of <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code>. You can use it to supply
names, e.g. <code>a := b</code> is equivalent to <code>a = b</code>. Since its syntax is
more flexible you can also force names on its LHS:</p><pre><span class='va'>name</span> <span class='op'>&lt;-</span> <span class='st'>"Jane"</span>

<span class='fu'><a href='list2.html'>list2</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>name</span> <span class='op'>:=</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='nse-defuse.html'>exprs</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>name</span> <span class='op'>:=</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>)</span>
</pre>

<p>Like <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code>, the <code>:=</code> operator expects strings or symbols on its LHS.</p>
<p>Since unquoting names is related to interpolating within a string
with the glue package, we have made the glue syntax available on
the LHS of <code>:=</code>:</p><pre><span class='fu'><a href='list2.html'>list2</a></span><span class='op'>(</span><span class='st'>"{name}"</span> <span class='op'>:=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'>tibble</span><span class='op'>(</span><span class='st'>"{name}"</span> <span class='op'>:=</span> <span class='fl'>1</span><span class='op'>)</span>
</pre>

<p>You can also interpolate defused function arguments with double
braces <code>{{</code>, similar to the curly-curly syntax:</p><pre><span class='va'>wrapper</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>var</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span><span class='st'>"{{ var }}_foo"</span> <span class='op'>:=</span> <span class='op'>{</span><span class='op'>{</span> <span class='va'>var</span> <span class='op'>}</span><span class='op'>}</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>
</pre>

<p>Currently, forcing names with <code>:=</code> only works in top level
expressions. These are all valid:</p><pre><span class='fu'><a href='nse-defuse.html'>exprs</a></span><span class='op'>(</span><span class='st'>"{name}"</span> <span class='op'>:=</span> <span class='va'>x</span><span class='op'>)</span>
<span class='fu'>tibble</span><span class='op'>(</span><span class='st'>"{name}"</span> <span class='op'>:=</span> <span class='va'>x</span><span class='op'>)</span>
</pre>

<p>But deep-forcing names isn't supported:</p><pre><span class='fu'><a href='nse-defuse.html'>exprs</a></span><span class='op'>(</span><span class='fu'>this</span><span class='op'>(</span><span class='fu'>is</span><span class='op'>(</span><span class='fu'>deep</span><span class='op'>(</span><span class='st'>"{name}"</span> <span class='op'>:=</span> <span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</pre>

    <h2 class="hasAnchor" id="theory"><a class="anchor" href="#theory"></a>Theory</h2>

    


<p>Formally, <code><a href='nse-defuse.html'>quo()</a></code> and <code><a href='nse-defuse.html'>expr()</a></code> are quasiquotation functions, <code>!!</code>
is the unquote operator, and <code>!!!</code> is the unquote-splice operator.
These terms have a rich history in Lisp languages, and live on in
modern languages like
<a href='https://docs.julialang.org/en/v1/manual/metaprogramming/'>Julia</a>
and
<a href='https://docs.racket-lang.org/reference/quasiquote.html'>Racket</a>.</p>
    <h2 class="hasAnchor" id="life-cycle"><a class="anchor" href="#life-cycle"></a>Life cycle</h2>

    

<ul>
<li><p>Calling <code>UQ()</code> and <code>UQS()</code> with the rlang namespace qualifier is
deprecated as of rlang 0.3.0. Just use the unqualified forms
instead:</p><pre><span class='co'># Bad</span>
<span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'>UQ</span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Ok</span>
<span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'>UQ</span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Good</span>
<span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>var</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>
</pre>

<p>Supporting namespace qualifiers complicates the implementation of
unquotation and is misleading as to the nature of unquoting
operators (which are syntactic operators that operate at
quotation-time rather than function calls at evaluation-time).</p></li>
<li><p><code>UQ()</code> and <code>UQS()</code> were soft-deprecated in rlang 0.2.0 in order
to make the syntax of quasiquotation more consistent. The prefix
forms are now <code>`!!`()</code> and <code>`!!!`()</code> which is
consistent with other R operators (e.g. <code>`+`(a, b)</code> is the
prefix form of <code>a + b</code>).</p>
<p>Note that the prefix forms are not as relevant as before because
<code>!!</code> now has the right operator precedence, i.e. the same as
unary <code><a href='https://rdrr.io/r/base/Arithmetic.html'>-</a></code> or <code><a href='https://rdrr.io/r/base/Arithmetic.html'>+</a></code>. It is thus safe to mingle it with other
operators, e.g. <code>!!a + !!b</code> does the right thing. In addition the
parser now strips one level of parentheses around unquoted
expressions. This way <code>(!!"foo")(...)</code> expands to <code>foo(...)</code>.
These changes make the prefix forms less useful.</p>
<p>Finally, the named functional forms <code>UQ()</code> and <code>UQS()</code> were
misleading because they suggested that existing knowledge about
functions is applicable to quasiquotation. This was reinforced by
the visible definitions of these functions exported by rlang and
by the tidy eval parser interpreting <code>rlang::UQ()</code> as <code>!!</code>. In
reality unquoting is <em>not</em> a function call, it is a syntactic
operation. The operator form makes it clearer that unquoting is
special.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Interpolation with {{  }} is the easiest way to forward</span>
<span class='co'># arguments to tidy eval functions:</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='search_envs.html'>is_attached</a></span><span class='op'>(</span><span class='st'>"package:dplyr"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>

<span class='co'># Forward all arguments involving data frame columns by</span>
<span class='co'># interpolating them within other data masked arguments.</span>
<span class='co'># Here we interpolate `arg` in a `summarise()` call:</span>
<span class='va'>my_function</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>arg</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>summarise</span><span class='op'>(</span><span class='va'>data</span>, avg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span> <span class='va'>arg</span> <span class='op'>}</span><span class='op'>}</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>my_function</span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>cyl</span><span class='op'>)</span>
<span class='fu'>my_function</span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>cyl</span> <span class='op'>*</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='co'># The  operator is just a shortcut for `!!enquo()`:</span>
<span class='va'>my_function</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>arg</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>summarise</span><span class='op'>(</span><span class='va'>data</span>, avg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='fu'><a href='nse-defuse.html'>enquo</a></span><span class='op'>(</span><span class='va'>arg</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>my_function</span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>cyl</span><span class='op'>)</span>

<span class='op'>}</span>

<span class='co'># Quasiquotation functions quote expressions like base::quote()</span>
<span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='va'>this</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(this)</div><div class='input'><span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='va'>this</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(this)</div><div class='input'><span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='va'>this</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^how_many(this)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>
<span class='co'># In addition, they support unquoting. Let's store symbols</span>
<span class='co'># (i.e. object names) in variables:</span>
<span class='va'>this</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span><span class='op'>(</span><span class='st'>"apples"</span><span class='op'>)</span>
<span class='va'>that</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span><span class='op'>(</span><span class='st'>"oranges"</span><span class='op'>)</span>

<span class='co'># With unquotation you can insert the contents of these variables</span>
<span class='co'># inside the quoted expression:</span>
<span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>this</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(apples)</div><div class='input'><span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>that</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(oranges)</div><div class='input'>
<span class='co'># You can also insert values:</span>
<span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(3)</div><div class='input'><span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^how_many(3)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>

<span class='co'># Note that when you unquote complex objects into an expression,</span>
<span class='co'># the base R printer may be a bit misleading. For instance compare</span>
<span class='co'># the output of `expr()` and `quo()` (which uses a custom printer)</span>
<span class='co'># when we unquote an integer vector:</span>
<span class='fu'><a href='nse-defuse.html'>expr</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(1:10)</div><div class='input'><span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^how_many(&lt;int: 1L, 2L, 3L, 4L, 5L, ...&gt;)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>
<span class='co'># This is why it's often useful to use qq_show() to examine the</span>
<span class='co'># result of unquotation operators. It uses the same printer as</span>
<span class='co'># quosures but does not return anything:</span>
<span class='fu'>qq_show</span><span class='op'>(</span><span class='fu'>how_many</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; how_many(&lt;int: 1L, 2L, 3L, 4L, 5L, ...&gt;)</div><div class='input'>

<span class='co'># Use `!!!` to add multiple arguments to a function. Its argument</span>
<span class='co'># should evaluate to a list or vector:</span>
<span class='va'>args</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>!</span><span class='va'>args</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^mean(&lt;int: 1L, 2L, 3L&gt;, na.rm = TRUE)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>
<span class='co'># You can combine the two</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>xyz</span><span class='op'>)</span>
<span class='va'>extra_args</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>trim <span class='op'>=</span> <span class='fl'>0.9</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>var</span> , <span class='op'>!</span><span class='op'>!</span><span class='op'>!</span><span class='va'>extra_args</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^mean(xyz, trim = 0.9, na.rm = TRUE)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>

<span class='co'># The plural versions have support for the `:=` operator.</span>
<span class='co'># Like `=`, `:=` creates named arguments:</span>
<span class='fu'><a href='nse-defuse.html'>quos</a></span><span class='op'>(</span><span class='va'>mouse1</span> <span class='op'>:=</span> <span class='va'>bernard</span>, mouse2 <span class='op'>=</span> <span class='va'>bianca</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;list_of&lt;quosure&gt;&gt;
#&gt; 
#&gt; $mouse1
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^bernard</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span>
#&gt; 
#&gt; $mouse2
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^bianca</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span>
#&gt; </div><div class='input'>
<span class='co'># The `:=` is mainly useful to unquote names. Unlike `=` it</span>
<span class='co'># supports `!!` on its LHS:</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='st'>"unquote me!"</span>
<span class='fu'><a href='nse-defuse.html'>quos</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>var</span> <span class='op'>:=</span> <span class='va'>bernard</span>, mouse2 <span class='op'>=</span> <span class='va'>bianca</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;list_of&lt;quosure&gt;&gt;
#&gt; 
#&gt; $`unquote me!`
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^bernard</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span>
#&gt; 
#&gt; $mouse2
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^bianca</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span>
#&gt; </div><div class='input'>

<span class='co'># All these features apply to dots captured by enquos():</span>
<span class='va'>fn</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='fu'><a href='nse-defuse.html'>enquos</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
<span class='fu'>fn</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='op'>!</span><span class='va'>args</span>, <span class='op'>!</span><span class='op'>!</span><span class='va'>var</span> <span class='op'>:=</span> <span class='va'>penny</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;list_of&lt;quosure&gt;&gt;
#&gt; 
#&gt; [[1]]
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: ^&lt;int: 1L, 2L, 3L&gt;
#&gt; env:  empty
#&gt; 
#&gt; $na.rm
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: ^TRUE
#&gt; env:  empty
#&gt; 
#&gt; $`unquote me!`
#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^penny</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span>
#&gt; </div><div class='input'>

<span class='co'># Unquoting is especially useful for building an expression by</span>
<span class='co'># expanding around a variable part (the unquoted part):</span>
<span class='va'>quo1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>toupper</a></span><span class='op'>(</span><span class='va'>foo</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>quo1</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^toupper(foo)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>
<span class='va'>quo2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>quo1</span>, <span class='va'>bar</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>quo2</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^paste(^toupper(foo), bar)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div><div class='input'>
<span class='va'>quo3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='nse-defuse.html'>quo</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>quo2</span>, <span class='op'>!</span><span class='op'>!</span><span class='op'>!</span><span class='fu'><a href='sym.html'>syms</a></span><span class='op'>(</span><span class='va'>letters</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>quo3</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^list(^paste(^toupper(foo), bar), a, b, c, d, e)</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fc30bfb0b10</span><span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


