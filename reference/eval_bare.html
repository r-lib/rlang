<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="eval_bare() is a lower-level version of function base::eval().
Technically, it is a simple wrapper around the C function
Rf_eval(). You generally don't need to use eval_bare() instead
of eval(). Its main advantage is that it handles stack-sensitive
calls (such as return(), on.exit() or parent.frame()) more
consistently when you pass an enviroment of a frame on the call
stack."><title>Evaluate an expression in an environment — eval_bare • rlang</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.0/font.css" rel="stylesheet"><link href="../deps/_Source%20Code%20Pro-0.4.0/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate an expression in an environment — eval_bare"><meta property="og:description" content="eval_bare() is a lower-level version of function base::eval().
Technically, it is a simple wrapper around the C function
Rf_eval(). You generally don't need to use eval_bare() instead
of eval(). Its main advantage is that it handles stack-sensitive
calls (such as return(), on.exit() or parent.frame()) more
consistently when you pass an enviroment of a frame on the call
stack."><meta property="og:image" content="https://rlang.r-lib.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rlang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tidy-evaluation">Tidy evaluation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tidy-evaluation">
    <h6 class="dropdown-header" data-toc-skip>Overviews</h6>
    <a class="dropdown-item" href="../reference/topic-data-mask.html">What is data-masking and why do I need `{{`?</a>
    <a class="dropdown-item" href="../reference/topic-data-mask-programming.html">Data mask programming patterns</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-data-mask-ambiguity.html">The data mask ambiguity</a>
    <a class="dropdown-item" href="../reference/topic-double-evaluation.html">The double evaluation problem</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-inject-out-of-context.html">What happens if I use injection operators out of context?</a>
    <a class="dropdown-item" href="../reference/topic-embrace-non-args.html">Does `{{` work on regular objects?</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-metaprogramming">Metaprogramming</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-metaprogramming">
    <h6 class="dropdown-header" data-toc-skip>Overviews</h6>
    <a class="dropdown-item" href="../reference/topic-defuse.html">Defusing R expressions</a>
    <a class="dropdown-item" href="../reference/topic-inject.html">Injecting with `!!`, `!!!`, and glue syntax</a>
    <a class="dropdown-item" href="../reference/topic-metaprogramming.html">Metaprogramming patterns</a>
    <a class="dropdown-item" href="../reference/topic-quosure.html">What are quosures and when are they needed?</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-multiple-columns.html">Taking multiple columns without `...`</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-embrace-constants.html">Why are strings and other constants enquosed in the empty environment?</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Release notes</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/rlang/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Evaluate an expression in an environment</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/rlang/blob/HEAD/R/eval.R" class="external-link"><code>R/eval.R</code></a></small>
      <div class="d-none name"><code>eval_bare.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>eval_bare()</code> is a lower-level version of function <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">base::eval()</a></code>.
Technically, it is a simple wrapper around the C function
<code>Rf_eval()</code>. You generally don't need to use <code>eval_bare()</code> instead
of <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code>. Its main advantage is that it handles stack-sensitive
calls (such as <code><a href="https://rdrr.io/r/base/function.html" class="external-link">return()</a></code>, <code><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit()</a></code> or <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code>) more
consistently when you pass an enviroment of a frame on the call
stack.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">eval_bare</span><span class="op">(</span><span class="va">expr</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>expr</dt>
<dd><p>An expression to evaluate.</p></dd>
<dt>env</dt>
<dd><p>The environment in which to evaluate the expression.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>These semantics are possible because <code>eval_bare()</code> creates only one
frame on the call stack whereas <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code> creates two frames, the
second of which has the user-supplied environment as frame
environment. When you supply an existing frame environment to
<code><a href="https://rdrr.io/r/base/eval.html" class="external-link">base::eval()</a></code> there will be two frames on the stack with the same
frame environment. Stack-sensitive functions only detect the
topmost of these frames. We call these evaluation semantics
"stack inconsistent".</p>
<p>Evaluating expressions in the actual frame environment has useful
practical implications for <code>eval_bare()</code>:</p><ul><li><p><code><a href="https://rdrr.io/r/base/function.html" class="external-link">return()</a></code> calls are evaluated in frame environments that might
be burried deep in the call stack. This causes a long return that
unwinds multiple frames (triggering the <code><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit()</a></code> event for
each frame). By contrast <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code> only returns from the <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code>
call, one level up.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit()</a></code>, <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code>, <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">sys.call()</a></code>, and generally all
the stack inspection functions <code>sys.xxx()</code> are evaluated in the
correct frame environment. This is similar to how this type of
calls can be evaluated deep in the call stack because of lazy
evaluation, when you force an argument that has been passed
around several times.</p></li>
</ul><p>The flip side of the semantics of <code>eval_bare()</code> is that it can't
evaluate <code><a href="https://rdrr.io/r/base/Control.html" class="external-link">break</a></code> or <code><a href="https://rdrr.io/r/base/Control.html" class="external-link">next</a></code> expressions even if called within a
loop.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="eval_tidy.html">eval_tidy()</a></code> for evaluation with data mask and quosure
support.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># eval_bare() works just like base::eval() but you have to create</span></span>
<span class="r-in"><span class="co"># the evaluation environment yourself:</span></span>
<span class="r-in"><span class="fu">eval_bare</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">foo</span><span class="op">)</span>, <span class="fu"><a href="env.html">env</a></span><span class="op">(</span>foo <span class="op">=</span> <span class="st">"bar"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bar"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># eval() has different evaluation semantics than eval_bare(). It</span></span>
<span class="r-in"><span class="co"># can return from the supplied environment even if its an</span></span>
<span class="r-in"><span class="co"># environment that is not on the call stack (i.e. because you've</span></span>
<span class="r-in"><span class="co"># created it yourself). The following would trigger an error with</span></span>
<span class="r-in"><span class="co"># eval_bare():</span></span>
<span class="r-in"><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">ret</span>, <span class="fu"><a href="env.html">env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "foo"</span>
<span class="r-in"><span class="co"># eval_bare(ret, env())  # "no function to return from" error</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Another feature of eval() is that you can control surround loops:</span></span>
<span class="r-in"><span class="va">bail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw">break</span><span class="op">)</span></span>
<span class="r-in"><span class="kw">while</span> <span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">bail</span><span class="op">)</span></span>
<span class="r-in">  <span class="co"># eval_bare(bail)  # "no loop for break/next" error</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># To explore the consequences of stack inconsistent semantics, let's</span></span>
<span class="r-in"><span class="co"># create a function that evaluates `parent.frame()` deep in the call</span></span>
<span class="r-in"><span class="co"># stack, in an environment corresponding to a frame in the middle of</span></span>
<span class="r-in"><span class="co"># the stack. For consistency with R's lazy evaluation semantics, we'd</span></span>
<span class="r-in"><span class="co"># expect to get the caller of that frame as result:</span></span>
<span class="r-in"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eval_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">    returned_env <span class="op">=</span> <span class="fu">middle</span><span class="op">(</span><span class="va">eval_fn</span><span class="op">)</span>,</span>
<span class="r-in">    actual_env <span class="op">=</span> <span class="fu"><a href="caller_env.html">current_env</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="va">middle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eval_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu">deep</span><span class="op">(</span><span class="va">eval_fn</span>, <span class="fu"><a href="caller_env.html">current_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="va">deep</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eval_fn</span>, <span class="va">eval_env</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu">eval_fn</span><span class="op">(</span><span class="va">expr</span>, <span class="va">eval_env</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># With eval_bare(), we do get the expected environment:</span></span>
<span class="r-in"><span class="fu">fn</span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="va">eval_bare</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $returned_env</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5584553af778&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $actual_env</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5584553af778&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># But that's not the case with base::eval():</span></span>
<span class="r-in"><span class="fu">fn</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $returned_env</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x558456dd3fd8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $actual_env</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x558456dd06b0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

  </div></footer></body></html>

