<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A data mask is an environment (or possibly
multiple environments forming an ancestry) containing user-supplied
objects. Objects in the mask have precedence over objects in the
environment (i.e. they mask those objects). Many R functions
evaluate quoted expressions in a data mask so these expressions can
refer to objects within the user data.
These functions let you construct a tidy eval data mask manually.
They are meant for developers of tidy eval interfaces rather than
for end users."><title>Create a data mask — as_data_mask • rlang</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.1/font.css" rel="stylesheet"><link href="../deps/_Source%20Code%20Pro-0.4.1/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a data mask — as_data_mask"><meta property="og:description" content="A data mask is an environment (or possibly
multiple environments forming an ancestry) containing user-supplied
objects. Objects in the mask have precedence over objects in the
environment (i.e. they mask those objects). Many R functions
evaluate quoted expressions in a data mask so these expressions can
refer to objects within the user data.
These functions let you construct a tidy eval data mask manually.
They are meant for developers of tidy eval interfaces rather than
for end users."><meta property="og:image" content="https://rlang.r-lib.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="rlang.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rlang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tidy-evaluation">Tidy evaluation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tidy-evaluation">
    <h6 class="dropdown-header" data-toc-skip>Overviews</h6>
    <a class="dropdown-item" href="../reference/topic-data-mask.html">What is data-masking and why do I need `{{`?</a>
    <a class="dropdown-item" href="../reference/topic-data-mask-programming.html">Data mask programming patterns</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-data-mask-ambiguity.html">The data mask ambiguity</a>
    <a class="dropdown-item" href="../reference/topic-double-evaluation.html">The double evaluation problem</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-inject-out-of-context.html">What happens if I use injection operators out of context?</a>
    <a class="dropdown-item" href="../reference/topic-embrace-non-args.html">Does `{{` work on regular objects?</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-metaprogramming">Metaprogramming</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-metaprogramming">
    <h6 class="dropdown-header" data-toc-skip>Overviews</h6>
    <a class="dropdown-item" href="../reference/topic-defuse.html">Defusing R expressions</a>
    <a class="dropdown-item" href="../reference/topic-inject.html">Injecting with `!!`, `!!!`, and glue syntax</a>
    <a class="dropdown-item" href="../reference/topic-metaprogramming.html">Metaprogramming patterns</a>
    <a class="dropdown-item" href="../reference/topic-quosure.html">What are quosures and when are they needed?</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-multiple-columns.html">Taking multiple columns without `...`</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-embrace-constants.html">Why are strings and other constants enquosed in the empty environment?</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-conditions">Conditions</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-conditions">
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-error-call.html">Including function calls in error messages</a>
    <a class="dropdown-item" href="../reference/topic-error-chaining.html">Including contextual information with error chains</a>
    <a class="dropdown-item" href="../reference/topic-condition-formatting.html">Formatting messages with cli</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-condition-customisation.html">Customising condition messages</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Release notes</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/rlang/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create a data mask</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/rlang/blob/HEAD/R/eval-tidy.R" class="external-link"><code>R/eval-tidy.R</code></a></small>
      <div class="d-none name"><code>as_data_mask.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A <a href="topic-data-mask.html">data mask</a> is an environment (or possibly
multiple environments forming an ancestry) containing user-supplied
objects. Objects in the mask have precedence over objects in the
environment (i.e. they mask those objects). Many R functions
evaluate quoted expressions in a data mask so these expressions can
refer to objects within the user data.</p>
<p>These functions let you construct a tidy eval data mask manually.
They are meant for developers of tidy eval interfaces rather than
for end users.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">as_data_mask</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="fu">as_data_pronoun</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>

<span class="fu">new_data_mask</span><span class="op">(</span><span class="va">bottom</span>, top <span class="op">=</span> <span class="va">bottom</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data frame or named vector of masking data.</p></dd>


<dt>bottom</dt>
<dd><p>The environment containing masking objects if the
data mask is one environment deep. The bottom environment if the
data mask comprises multiple environment.</p>
<p>If you haven't supplied <code>top</code>, this <strong>must</strong> be an environment
that you own, i.e. that you have created yourself.</p></dd>


<dt>top</dt>
<dd><p>The last environment of the data mask. If the data mask
is only one environment deep, <code>top</code> should be the same as
<code>bottom</code>.</p>
<p>This <strong>must</strong> be an environment that you own, i.e. that you have
created yourself. The parent of <code>top</code> will be changed by the tidy
eval engine and should be considered undetermined. Never make
assumption about the parent of <code>top</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data mask that you can supply to <code><a href="eval_tidy.html">eval_tidy()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="why-build-a-data-mask-">Why build a data mask?<a class="anchor" aria-label="anchor" href="#why-build-a-data-mask-"></a></h2>
    


<p>Most of the time you can just call <code><a href="eval_tidy.html">eval_tidy()</a></code> with a list or a
data frame and the data mask will be constructed automatically.
There are three main use cases for manual creation of data masks:</p><ul><li><p>When <code><a href="eval_tidy.html">eval_tidy()</a></code> is called with the same data in a tight loop.
Because there is some overhead to creating tidy eval data masks,
constructing the mask once and reusing it for subsequent
evaluations may improve performance.</p></li>
<li><p>When several expressions should be evaluated in the exact same
environment because a quoted expression might create new objects
that can be referred in other quoted expressions evaluated at a
later time. One example of this is <code><a href="https://tibble.tidyverse.org/reference/lst.html" class="external-link">tibble::lst()</a></code> where new
columns can refer to previous ones.</p></li>
<li><p>When your data mask requires special features. For instance the
data frame columns in dplyr data masks are implemented with
<a href="https://rdrr.io/r/base/delayedAssign.html" class="external-link">active bindings</a>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="building-your-own-data-mask">Building your own data mask<a class="anchor" aria-label="anchor" href="#building-your-own-data-mask"></a></h2>
    


<p>Unlike <code><a href="https://rdrr.io/r/base/eval.html" class="external-link">base::eval()</a></code> which takes any kind of environments as data
mask, <code><a href="eval_tidy.html">eval_tidy()</a></code> has specific requirements in order to support
<a href="topic-defuse.html">quosures</a>. For this reason you can't supply bare
environments.</p>
<p>There are two ways of constructing an rlang data mask manually:</p><ul><li><p><code>as_data_mask()</code> transforms a list or data frame to a data mask.
It automatically installs the data pronoun <code><a href="dot-data.html">.data</a></code>.</p></li>
<li><p><code>new_data_mask()</code> is a bare bones data mask constructor for
environments. You can supply a bottom and a top environment in
case your data mask comprises multiple environments (see section
below).</p>
<p>Unlike <code>as_data_mask()</code> it does not install the <code>.data</code> pronoun
so you need to provide one yourself. You can provide a pronoun
constructed with <code>as_data_pronoun()</code> or your own pronoun class.</p>
<p><code>as_data_pronoun()</code> will create a pronoun from a list, an
environment, or an rlang data mask. In the latter case, the whole
ancestry is looked up from the bottom to the top of the mask.
Functions stored in the mask are bypassed by the pronoun.</p></li>
</ul><p>Once you have built a data mask, simply pass it to <code><a href="eval_tidy.html">eval_tidy()</a></code> as
the <code>data</code> argument. You can repeat this as many times as
needed. Note that any objects created there (perhaps because of a
call to <code>&lt;-</code>) will persist in subsequent evaluations.</p>
    </div>
    <div class="section level2">
    <h2 id="top-and-bottom-of-data-mask">Top and bottom of data mask<a class="anchor" aria-label="anchor" href="#top-and-bottom-of-data-mask"></a></h2>
    


<p>In some cases you'll need several levels in your data mask. One
good reason is when you include functions in the mask. It's a good
idea to keep data objects one level lower than function objects, so
that the former cannot override the definitions of the latter (see
examples).</p>
<p>In that case, set up all your environments and keep track of the
bottom child and the top parent. You'll need to pass both to
<code>new_data_mask()</code>.</p>
<p>Note that the parent of the top environment is completely
undetermined, you shouldn't expect it to remain the same at all
times. This parent is replaced during evaluation by <code><a href="eval_tidy.html">eval_tidy()</a></code>
to one of the following environments:</p><ul><li><p>The default environment passed as the <code>env</code> argument of <code><a href="eval_tidy.html">eval_tidy()</a></code>.</p></li>
<li><p>The environment of the current quosure being evaluated, if applicable.</p></li>
</ul><p>Consequently, all masking data should be contained between the
bottom and top environment of the data mask.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Evaluating in a tidy evaluation environment enables all tidy</span></span>
<span class="r-in"><span class="co"># features:</span></span>
<span class="r-in"><span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu">as_data_mask</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="defusing-advanced.html">quo</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, <span class="va">mask</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [18] "r" "s" "t" "u" "v" "w" "x" "y" "z"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># You can install new pronouns in the mask:</span></span>
<span class="r-in"><span class="va">mask</span><span class="op">$</span><span class="va">.pronoun</span> <span class="op">&lt;-</span> <span class="fu">as_data_pronoun</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>foo <span class="op">=</span> <span class="st">"bar"</span>, baz <span class="op">=</span> <span class="st">"bam"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="defusing-advanced.html">quo</a></span><span class="op">(</span><span class="va">.pronoun</span><span class="op">$</span><span class="va">foo</span><span class="op">)</span>, <span class="va">mask</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "bar"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># In some cases the data mask can leak to the user, for example if</span></span>
<span class="r-in"><span class="co"># a function or formula is created in the data mask environment:</span></span>
<span class="r-in"><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="st">"user variable from the context"</span></span>
<span class="r-in"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">cyl</span><span class="op">)</span>, <span class="va">mask</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># If new objects are created in the mask, they persist in the</span></span>
<span class="r-in"><span class="co"># subsequent calls:</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">new</span> <span class="op">&lt;-</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">am</span><span class="op">)</span>, <span class="va">mask</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">new</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span>, <span class="va">mask</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 14 14 10 12 16 12 16  8  8 12 12 16 16 16 16 16 16 10 10 10  8 16 16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [24] 16 16 10 10 10 18 14 18 10</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># In some cases your data mask is a whole chain of environments</span></span>
<span class="r-in"><span class="co"># rather than a single environment. You'll have to use</span></span>
<span class="r-in"><span class="co"># `new_data_mask()` and let it know about the bottom of the mask</span></span>
<span class="r-in"><span class="co"># (the last child of the environment chain) and the topmost parent.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># A common situation where you'll want a multiple-environment mask</span></span>
<span class="r-in"><span class="co"># is when you include functions in your mask. In that case you'll</span></span>
<span class="r-in"><span class="co"># put functions in the top environment and data in the bottom. This</span></span>
<span class="r-in"><span class="co"># will prevent the data from overwriting the functions.</span></span>
<span class="r-in"><span class="va">top</span> <span class="op">&lt;-</span> <span class="fu"><a href="env.html">new_environment</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`+` <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span>, c <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Let's add a middle environment just for sport:</span></span>
<span class="r-in"><span class="va">middle</span> <span class="op">&lt;-</span> <span class="fu"><a href="env.html">env</a></span><span class="op">(</span><span class="va">top</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># And finally the bottom environment containing data:</span></span>
<span class="r-in"><span class="va">bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="env.html">env</a></span><span class="op">(</span><span class="va">middle</span>, a <span class="op">=</span> <span class="st">"a"</span>, b <span class="op">=</span> <span class="st">"b"</span>, c <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># We can now create a mask by supplying the top and bottom</span></span>
<span class="r-in"><span class="co"># environments:</span></span>
<span class="r-in"><span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu">new_data_mask</span><span class="op">(</span><span class="va">bottom</span>, top <span class="op">=</span> <span class="va">top</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># This data mask can be passed to eval_tidy() instead of a list or</span></span>
<span class="r-in"><span class="co"># data frame:</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">+</span> <span class="va">c</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mask</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a b c"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Note how the function `c()` and the object `c` are looked up</span></span>
<span class="r-in"><span class="co"># properly because of the multi-level structure:</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mask</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a b c"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># new_data_mask() does not create data pronouns, but</span></span>
<span class="r-in"><span class="co"># data pronouns can be added manually:</span></span>
<span class="r-in"><span class="va">mask</span><span class="op">$</span><span class="va">.fns</span> <span class="op">&lt;-</span> <span class="fu">as_data_pronoun</span><span class="op">(</span><span class="va">top</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># The `.data` pronoun should generally be created from the</span></span>
<span class="r-in"><span class="co"># mask. This will ensure data is looked up throughout the whole</span></span>
<span class="r-in"><span class="co"># ancestry. Only non-function objects are looked up from this</span></span>
<span class="r-in"><span class="co"># pronoun:</span></span>
<span class="r-in"><span class="va">mask</span><span class="op">$</span><span class="va">.data</span> <span class="op">&lt;-</span> <span class="fu">as_data_pronoun</span><span class="op">(</span><span class="va">mask</span><span class="op">)</span></span>
<span class="r-in"><span class="va">mask</span><span class="op">$</span><span class="va">.data</span><span class="op">$</span><span class="va">c</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "c"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Now we can reference values with the pronouns:</span></span>
<span class="r-in"><span class="fu"><a href="eval_tidy.html">eval_tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">a</span>, <span class="va">.data</span><span class="op">$</span><span class="va">b</span>, <span class="va">.data</span><span class="op">$</span><span class="va">c</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mask</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a b c"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

  </div></footer></body></html>

