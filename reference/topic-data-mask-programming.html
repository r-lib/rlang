<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Data-masking functions require special programming patterns when used inside other functions. In this topic we'll review and compare the different patterns that can be used to solve specific problems.
If you are a beginner, you might want to start with one of these tutorials:
Programming with dplyr
Using ggplot2 in packages


If you'd like to go further and learn about defusing and injecting expressions, read the metaprogramming patterns topic."><title>Data mask programming patterns — topic-data-mask-programming • rlang</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.0/font.css" rel="stylesheet"><link href="../deps/_Source%20Code%20Pro-0.4.0/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data mask programming patterns — topic-data-mask-programming"><meta property="og:description" content="Data-masking functions require special programming patterns when used inside other functions. In this topic we'll review and compare the different patterns that can be used to solve specific problems.
If you are a beginner, you might want to start with one of these tutorials:
Programming with dplyr
Using ggplot2 in packages


If you'd like to go further and learn about defusing and injecting expressions, read the metaprogramming patterns topic."><meta property="og:image" content="https://rlang.r-lib.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rlang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tidy-evaluation">Tidy evaluation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tidy-evaluation">
    <h6 class="dropdown-header" data-toc-skip>Overviews</h6>
    <a class="dropdown-item" href="../reference/topic-data-mask.html">What is data-masking and why do I need `{{`?</a>
    <a class="dropdown-item" href="../reference/topic-data-mask-programming.html">Data mask programming patterns</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-data-mask-ambiguity.html">The data mask ambiguity</a>
    <a class="dropdown-item" href="../reference/topic-double-evaluation.html">The double evaluation problem</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-inject-out-of-context.html">What happens if I use injection operators out of context?</a>
    <a class="dropdown-item" href="../reference/topic-embrace-non-args.html">Does `{{` work on regular objects?</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-metaprogramming">Metaprogramming</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-metaprogramming">
    <h6 class="dropdown-header" data-toc-skip>Overviews</h6>
    <a class="dropdown-item" href="../reference/topic-defuse.html">Defusing R expressions</a>
    <a class="dropdown-item" href="../reference/topic-inject.html">Injecting with `!!`, `!!!`, and glue syntax</a>
    <a class="dropdown-item" href="../reference/topic-metaprogramming.html">Metaprogramming patterns</a>
    <a class="dropdown-item" href="../reference/topic-quosure.html">What are quosures and when are they needed?</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../reference/topic-multiple-columns.html">Taking multiple columns without `...`</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Notes</h6>
    <a class="dropdown-item" href="../reference/topic-embrace-constants.html">Why are strings and other constants enquosed in the empty environment?</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Release notes</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/rlang/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data mask programming patterns</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/rlang/blob/HEAD/R/topic-nse.R" class="external-link"><code>R/topic-nse.R</code></a></small>
      <div class="d-none name"><code>topic-data-mask-programming.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="topic-data-mask.html">Data-masking</a> functions require special programming patterns when used inside other functions. In this topic we'll review and compare the different patterns that can be used to solve specific problems.</p>
<p>If you are a beginner, you might want to start with one of these tutorials:</p><ul><li><p><a href="https://dplyr.tidyverse.org/articles/programming.html" class="external-link">Programming with dplyr</a></p></li>
<li><p><a href="https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html" class="external-link">Using ggplot2 in packages</a></p></li>
</ul><p>If you'd like to go further and learn about defusing and injecting expressions, read the <a href="topic-metaprogramming.html">metaprogramming patterns topic</a>.</p>
    </div>


    <div class="section level2">
    <h2 id="choosing-a-pattern">Choosing a pattern<a class="anchor" aria-label="anchor" href="#choosing-a-pattern"></a></h2>
    <p>Two main considerations determine which programming pattern you need to wrap a data-masking function:</p><ol><li><p>What behaviour does the <em>wrapped</em> function implement?</p></li>
<li><p>What behaviour should <em>your</em> function implement?</p></li>
</ol><p>Depending on the answers to these questions, you can choose between these approaches:</p><ul><li><p>The <strong>forwarding patterns</strong> with which your function inherits the behaviour of the function it interfaces with.</p></li>
<li><p>The <strong>name patterns</strong> with which your function takes strings or character vectors of column names.</p></li>
<li><p>The <strong>bridge patterns</strong> with which you change the behaviour of an argument instead of inheriting it.</p></li>
</ul><p>You will also need to use different solutions for single named arguments than for multiple arguments in <code>...</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="argument-behaviours">Argument behaviours<a class="anchor" aria-label="anchor" href="#argument-behaviours"></a></h2>
    <p>In a regular function, arguments can be defined in terms of a <em>type</em> of objects that they accept. An argument might accept a character vector, a data frame, a single logical value, etc. Data-masked arguments are more complex. Not only do they generally accept a specific type of objects (for instance <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> accepts vectors), they exhibit special computational behaviours.</p><ul><li><p>Data-masked expressions (base): E.g. <code><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform()</a></code>, <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code>.  Expressions may refer to the columns of the supplied data frame.</p></li>
<li><p>Data-masked expressions (tidy eval): E.g. <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>, <code>ggplot2::aes()</code>. Same as base data-masking but with tidy eval features enabled. This includes <a href="topic-inject.html">injection operators</a> such as <code><a href="embrace-operator.html">{{</a></code> and <code><a href="injection-operator.html">!!</a></code> and the <code><a href="dot-data.html">.data</a></code> and <code><a href="dot-data.html">.env</a></code> pronouns.</p></li>
<li><p>Data-masked symbols: Same as data-masked arguments but the supplied expressions must be simple column names. This often simplifies things, for instance this is an easy way of avoiding issues of <a href="topic-double-evaluation.html">double evaluation</a>.</p></li>
<li><p><a href="https://tidyselect.r-lib.org/reference/language.html" class="external-link">Tidy selections</a>: E.g. <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code>, <code>tidyr::pivot_longer()</code>. This is an alternative to data masking that supports selection helpers like <code>starts_with()</code> or <code>all_of()</code>, and implements special behaviour for operators like <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, <code>|</code> and <code>&amp;</code>.</p>
<p>Unlike data masking, tidy selection is an interpreted dialect. There is in fact no masking at all. Expressions are either interpreted in the context of the data frame (e.g. <code>c(cyl, am)</code> which stands for the union of the columns <code>cyl</code> and <code>am</code>), or evaluated in the user environment (e.g. <code>all_of()</code>, <code>starts_with()</code>, and any other expressions). This has implications for inheritance of argument behaviour as we will see below.</p></li>
<li><p><a href="dyn-dots.html">Dynamic dots</a>: These may be data-masked arguments, tidy selections, or just regular arguments. Dynamic dots support injection of multiple arguments with the <code><a href="splice-operator.html">!!!</a></code> operator as well as name injection with <a href="glue-operators.html">glue</a> operators.</p></li>
</ul><p>To let users know about the capabilities of your function arguments, document them with the following tags, depending on which set of semantics they inherit from:</p><div class="sourceCode"><pre><code>@param foo &lt;[`data-masked`][dplyr::dplyr_data_masking]&gt; What `foo` does.

@param bar &lt;[`tidy-select`][dplyr::dplyr_tidy_select]&gt; What `bar` does.

@param ... &lt;[`dynamic-dots`][rlang::dyn-dots]&gt; What these dots do.
</code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="forwarding-patterns">Forwarding patterns<a class="anchor" aria-label="anchor" href="#forwarding-patterns"></a></h2>
    <p>With the forwarding patterns, arguments inherit the behaviour of the data-masked arguments they are passed in.</p><div class="section">
<h3 id="embrace-with-">Embrace with <code>{{</code><a class="anchor" aria-label="anchor" href="#embrace-with-"></a></h3>


<p>The embrace operator <code><a href="embrace-operator.html">{{</a></code> is a forwarding syntax for single arguments. You can forward an argument in data-masked context:</p><div class="sourceCode r"><pre><code><span class="va">my_summarise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre><p></p></div>
<p>Or in tidyselections:</p><div class="sourceCode r"><pre><code><span class="va">my_pivot_longer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre><p></p></div>
<p>The function automatically inherits the behaviour of the surrounding context. For instance arguments forwarded to a data-masked context may refer to columns or use the <code><a href="dot-data.html">.data</a></code> pronoun:</p><div class="sourceCode r"><pre><code><span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_summarise</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"cyl"</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_summarise</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre><p></p></div>
<p>And arguments forwarded to a tidy selection may use all tidyselect features:</p><div class="sourceCode r"><pre><code><span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_pivot_longer</span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_pivot_longer</span><span class="op">(</span><span class="va">vs</span><span class="op">:</span><span class="va">gear</span><span class="op">)</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"am"</span><span class="op">)</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_pivot_longer</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="forward-">Forward <code>...</code><a class="anchor" aria-label="anchor" href="#forward-"></a></h3>


<p>Simple forwarding of <code>...</code> arguments does not require any special syntax since dots are already a forwarding syntax. Just pass them to another function like you normally would. This works with data-masked arguments:</p><div class="sourceCode r"><pre><code><span class="va">my_group_by</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">.data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_group_by</span><span class="op">(</span>cyl <span class="op">=</span> <span class="va">cyl</span> <span class="op">*</span> <span class="fl">100</span>, <span class="va">am</span><span class="op">)</span></code></pre><p></p></div>
<p>As well as tidy selections:</p><div class="sourceCode r"><pre><code><span class="va">my_select</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">.data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span>, <span class="va">vs</span><span class="op">:</span><span class="va">carb</span><span class="op">)</span></code></pre><p></p></div>
<p>Some functions take a tidy selection in a single named argument. In that case, pass the <code>...</code> inside <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>:</p><div class="sourceCode r"><pre><code><span class="va">my_pivot_longer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">.data</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span>, <span class="va">vs</span><span class="op">:</span><span class="va">carb</span><span class="op">)</span></code></pre><p></p></div>
<p>Inside a tidy selection, <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> is not a vector concatenator but a selection combinator. This makes it handy to interface between functions that take <code>...</code> and functions that take a single argument.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="names-patterns">Names patterns<a class="anchor" aria-label="anchor" href="#names-patterns"></a></h2>
    <p>With the names patterns you refer to columns by name with strings or character vectors stored in env-variables. Whereas the forwarding patterns are exclusively used within a function to pass <em>arguments</em>, the names patterns can be used anywhere.</p><ul><li><p>In a script, you can loop over a character vector with <code>for</code> or <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> and use the <code><a href="dot-data.html">.data</a></code> pattern to connect a name to its data-variable. A vector can also be supplied all at once to the tidy select helper <code>all_of()</code>.</p></li>
<li><p>In a function, using the names patterns on function arguments lets users supply regular data-variable names without any of the complications that come with data-masking.</p></li>
</ul><div class="section">
<h3 id="subsetting-the-data-pronoun">Subsetting the <code>.data</code> pronoun<a class="anchor" aria-label="anchor" href="#subsetting-the-data-pronoun"></a></h3>


<p>The <code><a href="dot-data.html">.data</a></code> pronoun is a tidy eval feature that is enabled in all data-masked arguments, just like <code><a href="embrace-operator.html">{{</a></code>. The pronoun represents the data mask and can be subsetted with <code>[[</code> and <code>$</code>. These three statements are equivalent:</p><div class="sourceCode r"><pre><code><span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span>

<span class="va">var</span> <span class="op">&lt;-</span> <span class="st">"cyl"</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre><p></p></div>
<p>The <code>.data</code> pronoun can be subsetted in loops:</p><div class="sourceCode r"><pre><code><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"am"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">vars</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">mtcars</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 0.406</span>

<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">vars</span>, <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">mtcars</span>, mean <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">.x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 0.406</span></code></pre><p></p></div>
<p>And it can be used to connect function arguments to a data-variable:</p><div class="sourceCode r"><pre><code><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">my_mean</span><span class="op">(</span><span class="va">mtcars</span>, <span class="st">"cyl"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19</span></code></pre><p></p></div>
<p>With this implementation, <code>my_mean()</code> is completely insulated from data-masking behaviour and is called like an ordinary function.</p><div class="sourceCode r"><pre><code><span class="co"># No masking</span>
<span class="va">am</span> <span class="op">&lt;-</span> <span class="st">"cyl"</span>
<span class="fu">my_mean</span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">am</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19</span>

<span class="co"># Programmable</span>
<span class="fu">my_mean</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="st">"CYL"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;    mean</span>
<span class="co">#&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19</span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="character-vector-of-names">Character vector of names<a class="anchor" aria-label="anchor" href="#character-vector-of-names"></a></h3>


<p>The <code>.data</code> pronoun can only be subsetted with single column names. It doesn't support single-bracket indexing:</p><div class="sourceCode r"><pre><code><span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"am"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; Error in `dplyr::summarise()`:</span>
<span class="co">#&gt; ! Problem while computing `..1 = .data[c("cyl", "am")]`.</span>
<span class="co">#&gt; Caused by error in `.data[c("cyl", "am")]`:</span>
<span class="co">#&gt; ! `[` is not supported by the `.data` pronoun, use `[[` or $ instead.</span></code></pre><p></p></div>
<p>There is no plural variant of <code>.data</code> built in tidy eval. Instead, we'll used the <code>all_of()</code> operator available in tidy selections to supply character vectors. This is straightforward in functions that take tidy selections, like <code>tidyr::pivot_longer()</code>:</p><div class="sourceCode r"><pre><code><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"am"</span><span class="op">)</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 64 x 11</span>
<span class="co">#&gt;     mpg  disp    hp  drat    wt  qsec    vs  gear  carb name  value</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1    21   160   110   3.9  2.62  16.5     0     4     4 cyl       6</span>
<span class="co">#&gt; 2    21   160   110   3.9  2.62  16.5     0     4     4 am        1</span>
<span class="co">#&gt; 3    21   160   110   3.9  2.88  17.0     0     4     4 cyl       6</span>
<span class="co">#&gt; 4    21   160   110   3.9  2.88  17.0     0     4     4 am        1</span>
<span class="co">#&gt; # ... with 60 more rows</span></code></pre><p></p></div>
<p>If the function does not take a tidy selection, it might be possible to use a <em>bridge pattern</em>. This option is presented in the bridge section below. If a bridge is impossible or inconvenient, a little metaprogramming with the <a href="topic-metaprogramming.html">symbolise-and-inject pattern</a> can help.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="bridge-patterns">Bridge patterns<a class="anchor" aria-label="anchor" href="#bridge-patterns"></a></h2>
    <p>Sometimes the function you are calling does not implement the behaviour you would like to give to the arguments of your function. To work around this may require a little thought since there is no systematic way of turning one behaviour into another. The general technique consists in forwarding the arguments inside a context that implements the behaviour that you want. Then, find a way to bridge the result to the target verb or function.</p><div class="section">
<h3 id="across-as-a-selection-to-data-mask-bridge"><code>across()</code> as a selection to data-mask bridge<a class="anchor" aria-label="anchor" href="#across-as-a-selection-to-data-mask-bridge"></a></h3>


<p>dplyr 1.0 added support for tidy selections in all verbs via <code>across()</code>. This function is normally used for mapping over columns but can also be used to perform a simple selection. For instance, if you'd like to pass an argument to <code>group_by()</code> with a tidy-selection interface instead of a data-masked one, use <code>across()</code> as a bridge:</p><div class="sourceCode r"><pre><code><span class="va">my_group_by</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_group_by</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span><span class="op">)</span></code></pre><p></p></div>
<p>Since <code>across()</code> takes selections in a single argument (unlike <code>select()</code> which takes multiple arguments), you can't directly pass <code>...</code>. Instead, take them within <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, which is the tidyselect way of supplying multiple selections within a single argument:</p><div class="sourceCode r"><pre><code>my_group_by &lt;- function(.data, ...) {
  .data %&gt;% dplyr::group_by(across(c(...)}))
}

mtcars %&gt;% my_group_by(starts_with("c"), vs:gear)
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="across-all-of-as-a-names-to-data-mask-bridge"><code>across(all_of())</code> as a names to data mask bridge<a class="anchor" aria-label="anchor" href="#across-all-of-as-a-names-to-data-mask-bridge"></a></h3>


<p>If instead of forwarding variables in <code>across()</code> you pass them to <code>all_of()</code>, you create a names to data mask bridge.</p><div class="sourceCode r"><pre><code><span class="va">my_group_by</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">vars</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_group_by</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"am"</span><span class="op">)</span><span class="op">)</span></code></pre><p></p></div>
<p>Use this bridge technique to connect vectors of names to a data-masked context.</p>
</div>

<div class="section">
<h3 id="transmute-as-a-data-mask-to-selection-bridge"><code>transmute()</code> as a data-mask to selection bridge<a class="anchor" aria-label="anchor" href="#transmute-as-a-data-mask-to-selection-bridge"></a></h3>


<p>Passing data-masked arguments to a tidy selection is a little more tricky and requires a three step process.</p><div class="sourceCode r"><pre><code><span class="va">my_pivot_longer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Forward `...` in data-mask context with `transmute()`</span>
  <span class="co"># and save the inputs names</span>
  <span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span>
  <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inputs</span><span class="op">)</span>
  
  <span class="co"># Update the data with the inputs</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">inputs</span><span class="op">)</span>

  <span class="co"># Select the inputs by name with `all_of()`</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">pivot_longer</span><span class="op">(</span><span class="va">data</span>, cols <span class="op">=</span> <span class="fu">all_of</span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_pivot_longer</span><span class="op">(</span><span class="va">cyl</span>, am <span class="op">=</span> <span class="va">am</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></code></pre><p></p></div><ol><li><p>In a first step we pass the <code>...</code> expressions to <code>transmute()</code>. Unlike <code>mutate()</code>, it creates a new data frame from the user inputs. The only goal of this step is to inspect the names in <code>...</code>, including the default names created for unnamed arguments.</p></li>
<li><p>Once we have the names, we inject the arguments into <code>mutate()</code> to update the data frame.</p></li>
<li><p>Finally, we pass the names to the tidy selection via <a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link"><code>all_of()</code></a>.</p></li>
</ol></div>

    </div>
    <div class="section level2">
    <h2 id="transformation-patterns">Transformation patterns<a class="anchor" aria-label="anchor" href="#transformation-patterns"></a></h2>
    
<div class="section">
<h3 id="named-inputs-versus-">Named inputs versus <code>...</code><a class="anchor" aria-label="anchor" href="#named-inputs-versus-"></a></h3>


<p>In the case of a named argument, transformation is easy. We simply surround the embraced input it in R code. For instance, the <code>my_summarise()</code> function is not exactly useful compared to just calling <code>summarise()</code>:</p><div class="sourceCode r"><pre><code><span class="va">my_summarise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre><p></p></div>
<p>We can make it more useful by adding code around the variable:</p><div class="sourceCode r"><pre><code><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">var</span> <span class="op">}</span><span class="op">}</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre><p></p></div>
<p>For inputs in <code>...</code> however, this technique does not work. We would need some kind of templating syntax for dots that lets us specify R code with a placeholder for the dots elements. This isn't built in tidy eval but you can use operators like <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">dplyr::across()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">dplyr::if_all()</a></code>, or <code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">dplyr::if_any()</a></code>. When that isn't possible, you can template the expression manually.</p>
</div>

<div class="section">
<h3 id="transforming-inputs-with-across-">Transforming inputs with <code>across()</code><a class="anchor" aria-label="anchor" href="#transforming-inputs-with-across-"></a></h3>


<p>The <code>across()</code> operation in dplyr is a convenient way of mapping an expression across a set of inputs. We will create a variant of <code>my_mean()</code> that computes the <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> of all arguments supplied in <code>...</code>. The easiest way it to forward the dots to <code>across()</code> (which causes <code>...</code> to inherit its tidy selection behaviour):</p><div class="sourceCode r"><pre><code><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_mean</span><span class="op">(</span><span class="va">cyl</span>, <span class="va">carb</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;     cyl  carb</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19  2.81</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_mean</span><span class="op">(</span>foo <span class="op">=</span> <span class="va">cyl</span>, bar <span class="op">=</span> <span class="va">carb</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;     foo   bar</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19  2.81</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">my_mean</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span>, <span class="va">mpg</span><span class="op">:</span><span class="va">disp</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;     cyl  carb   mpg  disp</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  6.19  2.81  20.1  231.</span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="transforming-inputs-with-if-all-and-if-any-">Transforming inputs with <code>if_all()</code> and <code>if_any()</code><a class="anchor" aria-label="anchor" href="#transforming-inputs-with-if-all-and-if-any-"></a></h3>


<p><code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> requires a different operation than <code>across()</code> because it needs to combine the logical expressions with <code>&amp;</code> or <code>|</code>. To solve this problem dplyr introduced the <code>if_all()</code> and <code>if_any()</code> variants of <code>across()</code>.</p>
<p>In the following example, we filter all rows for which a set of variables are not equal to their minimum value:</p><div class="sourceCode r"><pre><code><span class="va">filter_non_baseline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">.data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">if_all</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">filter_non_baseline</span><span class="op">(</span><span class="va">vs</span>, <span class="va">am</span>, <span class="va">gear</span><span class="op">)</span></code></pre><p></p></div>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.9000.</p>
</div>

  </div></footer></body></html>

