<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quotation — quotation • rlang</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<meta property="og:title" content="Quotation — quotation" />

<meta property="og:description" content="Quotation is a mechanism by which an expression supplied as
argument is captured by a function. Instead of seeing the value of
the argument, the function sees the recipe (the R code) to make
that value. This is possible because R expressions are
representable as regular objects in R:
Calls represent the action of calling a function to
compute a new value. Evaluating a call causes that value to be
computed. Calls typically involve symbols to reference R objects.
Symbols represent the name that is given to an object in a
particular context (an environment).
" />

<meta property="og:description" content="We call objects containing calls and symbols expressions.
There are two ways to create R expressions. First you can build
calls and symbols from parts and pieces (see sym(), syms() and
call2()). The other way is by quotation or quasiquotation,
i.e. by intercepting an expression instead of evaluating it." />
<meta name="twitter:card" content="summary" />
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rlang</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Lifecycle</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quotation</h1>
    </div>

    
    <p>Quotation is a mechanism by which an expression supplied as
argument is captured by a function. Instead of seeing the value of
the argument, the function sees the recipe (the R code) to make
that value. This is possible because R <a href='is_expr.html'>expressions</a> are
representable as regular objects in R:</p><ul>
<li><p>Calls represent the action of calling a function to
compute a new value. Evaluating a call causes that value to be
computed. Calls typically involve symbols to reference R objects.</p></li>
<li><p>Symbols represent the name that is given to an object in a
particular context (an <a href='env.html'>environment</a>).</p></li>
</ul>

    <p>We call objects containing calls and symbols <a href='is_expr.html'>expressions</a>.
There are two ways to create R expressions. First you can <strong>build</strong>
calls and symbols from parts and pieces (see <code><a href='sym.html'>sym()</a></code>, <code><a href='sym.html'>syms()</a></code> and
<code><a href='call2.html'>call2()</a></code>). The other way is by <em>quotation</em> or <em>quasiquotation</em>,
i.e. by intercepting an expression instead of evaluating it.</p>
    

    <pre class="usage"><span class='fu'>expr</span>(<span class='no'>expr</span>)

<span class='fu'>enexpr</span>(<span class='no'>arg</span>)

<span class='fu'>exprs</span>(<span class='no'>...</span>, <span class='kw'>.named</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>.ignore_empty</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span>),
  <span class='kw'>.unquote_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>enexprs</span>(<span class='no'>...</span>, <span class='kw'>.named</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>.ignore_empty</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span>),
  <span class='kw'>.unquote_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>ensym</span>(<span class='no'>arg</span>)

<span class='fu'>ensyms</span>(<span class='no'>...</span>, <span class='kw'>.named</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>.ignore_empty</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span>),
  <span class='kw'>.unquote_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>quo</span>(<span class='no'>expr</span>)

<span class='fu'>enquo</span>(<span class='no'>arg</span>)

<span class='fu'>quos</span>(<span class='no'>...</span>, <span class='kw'>.named</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>.ignore_empty</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span>),
  <span class='kw'>.unquote_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>enquos</span>(<span class='no'>...</span>, <span class='kw'>.named</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>.ignore_empty</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span>),
  <span class='kw'>.unquote_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>An expression.</p></td>
    </tr>
    <tr>
      <th>arg</th>
      <td><p>A symbol representing an argument. The expression
supplied to that argument will be captured instead of being
evaluated.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For <code>enexprs()</code>, <code>ensyms()</code> and <code>enquos()</code>, names of
arguments to capture without evaluation (including <code>...</code>). For
<code>exprs()</code> and <code>quos()</code>, the expressions to capture unevaluated
(including expressions contained in <code>...</code>).</p></td>
    </tr>
    <tr>
      <th>.named</th>
      <td><p>Whether to ensure all dots are named. Unnamed
elements are processed with <code><a href='expr_label.html'>expr_text()</a></code> to figure out a default
name. If an integer, it is passed to the <code>width</code> argument of
<code><a href='expr_label.html'>expr_text()</a></code>, if <code>TRUE</code>, the default width is used. See
<code><a href='exprs_auto_name.html'>exprs_auto_name()</a></code>.</p></td>
    </tr>
    <tr>
      <th>.ignore_empty</th>
      <td><p>Whether to ignore empty arguments. Can be one
of <code>"trailing"</code>, <code>"none"</code>, <code>"all"</code>. If <code>"trailing"</code>, only the
last argument is ignored if it is empty.</p></td>
    </tr>
    <tr>
      <th>.unquote_names</th>
      <td><p>Whether to treat <code>:=</code> as <code>=</code>. Unlike <code>=</code>, the
<code>:=</code> syntax supports <code>!!</code> unquoting on the LHS.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="user-expressions-versus-your-expressions"><a class="anchor" href="#user-expressions-versus-your-expressions"></a>User expressions versus your expressions</h2>

    
    <p>There are two points of view when it comes to capturing an
expression:</p><ul>
<li><p>You can capture the expressions supplied by <em>the user</em> of your
function. This is the purpose of <code>ensym()</code>, <code>enexpr()</code> and
<code>enquo()</code> and their plural variants. These functions take an
argument name and capture the expression that was supplied to
that argument.</p></li>
<li><p>You can capture the expressions that <em>you</em> supply. To this end
use <code>expr()</code> and <code>quo()</code> and their plural variants <code>exprs()</code> and
<code>quos()</code>.</p></li>
</ul>
    
    <h2 class="hasAnchor" id="capture-raw-expressions"><a class="anchor" href="#capture-raw-expressions"></a>Capture raw expressions</h2>

    
    <ul>
<li><p><code>enexpr()</code> and <code>expr()</code> capture a single raw expression.</p></li>
<li><p><code>enexprs()</code> and <code>exprs()</code> capture a list of raw expressions
including expressions contained in <code>...</code>.</p></li>
<li><p><code>ensym()</code> and <code>ensyms()</code> are variants of <code>enexpr()</code> and
<code>enexprs()</code> that check the captured expression is either a string
(which they convert to symbol) or a symbol. If anything else
is supplied they throw an error.</p></li>
</ul>
    <p>In terms of base functions, <code>enexpr(arg)</code> corresponds to
<code><a href='http://www.rdocumentation.org/packages/base/topics/substitute'>base::substitute(arg)</a></code> (though that function has complex
semantics) and <code>expr()</code> is like <code>quote()</code> (and <code>bquote()</code> if we
consider unquotation syntax). The plural variant <code>exprs()</code> is
equivalent to <code><a href='http://www.rdocumentation.org/packages/base/topics/list'>base::alist()</a></code>. Finally there is no function in base
R that is equivalent to <code>enexprs()</code> but you can reproduce its
behaviour with <code>eval(substitute(alist(...)))</code>.</p>
    
    <h2 class="hasAnchor" id="capture-expressions-in-quosures"><a class="anchor" href="#capture-expressions-in-quosures"></a>Capture expressions in quosures</h2>

    
    <p><code>quo()</code> and <code>enquo()</code> are similar to their <code>expr</code> counterparts but
capture both the expression and its environment in an object called
a quosure. This wrapper contains a reference to the original
environment in which that expression was captured. Keeping track of
the environments of expressions is important because this is where
functions and objects mentioned in the expression are defined.</p>
<p>Quosures are objects that can be evaluated with <code><a href='eval_tidy.html'>eval_tidy()</a></code> just
like symbols or function calls. Since they always evaluate in their
original environment, quosures can be seen as a vehicle that allow
expressions to travel from function to function but that beam back
instantly to their original environment upon evaluation.</p>
<p>See the <a href='quosure.html'>quosure</a> help topic about tools to work with quosures.</p>
    
    <h2 class="hasAnchor" id="quasiquotation"><a class="anchor" href="#quasiquotation"></a>Quasiquotation</h2>

    
    <p>All quotation functions in rlang have support for <a href='quasiquotation.html'>unquoting
operators</a>. The combination of quotation and
unquotation is called <em>quasiquotation</em>.</p>
<p>Unquotation provides a way to refer to variables during quotation.
Variables are problematic when quoting because a captured
expression is essentially a constant, just like a string is a
constant. For instance in all the following cases <code>apple</code> is a
constant: <code>~apple</code>, <code>"apple"</code> and <code>expr(apple)</code>. Unquoting allows
you to introduce a part of variability within a captured
expression.</p><ul>
<li><p>In the case of <code>enexpr()</code> and <code>enquo()</code>, unquoting provides an
escape hatch to the users of your function that allows them to
manipulate the expression that you capture.</p></li>
<li><p>In the case of <code>expr()</code> and <code>quo()</code>, quasiquotation lets you
build a complex expressions where some parts are constant (the
parts that are captured) and some parts are variable (the parts
that are unquoted).</p></li>
</ul>
    <p>See the <a href='quasiquotation.html'>quasiquotation</a> help topic for more about this as well as
<a href='https://adv-r.hadley.nz/quasiquotation.html'>the chapter in Advanced R</a>.</p>
    
    <h2 class="hasAnchor" id="life-cycle"><a class="anchor" href="#life-cycle"></a>Life cycle</h2>

    
    <p>All the quotation functions mentioned here are stable.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># expr() and exprs() capture expressions that you supply:</span>
<span class='fu'>expr</span>(<span class='no'>symbol</span>)</div><div class='output co'>#&gt; symbol</div><div class='input'><span class='fu'>exprs</span>(<span class='no'>several</span>, <span class='no'>such</span>, <span class='no'>symbols</span>)</div><div class='output co'>#&gt; [[1]]
#&gt; several
#&gt; 
#&gt; [[2]]
#&gt; such
#&gt; 
#&gt; [[3]]
#&gt; symbols
#&gt; </div><div class='input'>
<span class='co'># enexpr() and enexprs() capture expressions that your user supplied:</span>
<span class='no'>expr_inputs</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>arg</span>, <span class='no'>...</span>) {
  <span class='no'>user_exprs</span> <span class='kw'>&lt;-</span> <span class='fu'>enexprs</span>(<span class='no'>arg</span>, <span class='no'>...</span>)
  <span class='no'>user_exprs</span>
}
<span class='fu'>expr_inputs</span>(<span class='no'>hello</span>)</div><div class='output co'>#&gt; [[1]]
#&gt; hello
#&gt; </div><div class='input'><span class='fu'>expr_inputs</span>(<span class='no'>hello</span>, <span class='no'>bonjour</span>, <span class='no'>ciao</span>)</div><div class='output co'>#&gt; [[1]]
#&gt; hello
#&gt; 
#&gt; [[2]]
#&gt; bonjour
#&gt; 
#&gt; [[3]]
#&gt; ciao
#&gt; </div><div class='input'>
<span class='co'># ensym() and ensyms() provide additional type checking to ensure</span>
<span class='co'># the user calling your function has supplied bare object names:</span>
<span class='no'>sym_inputs</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>...</span>) {
  <span class='no'>user_symbols</span> <span class='kw'>&lt;-</span> <span class='fu'>ensyms</span>(<span class='no'>...</span>)
  <span class='no'>user_symbols</span>
}
<span class='fu'>sym_inputs</span>(<span class='no'>hello</span>, <span class='st'>"bonjour"</span>)</div><div class='output co'>#&gt; [[1]]
#&gt; hello
#&gt; 
#&gt; [[2]]
#&gt; bonjour
#&gt; </div><div class='input'><span class='co'>## sym_inputs(say(hello))  # Error: Must supply symbols or strings</span>
<span class='fu'>expr_inputs</span>(<span class='fu'>say</span>(<span class='no'>hello</span>))</div><div class='output co'>#&gt; [[1]]
#&gt; say(hello)
#&gt; </div><div class='input'>

<span class='co'># All these quoting functions have quasiquotation support. This</span>
<span class='co'># means that you can unquote (evaluate and inline) part of the</span>
<span class='co'># captured expression:</span>
<span class='no'>what</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span>(<span class='st'>"bonjour"</span>)
<span class='fu'>expr</span>(<span class='fu'>say</span>(<span class='no'>what</span>))</div><div class='output co'>#&gt; say(what)</div><div class='input'><span class='fu'>expr</span>(<span class='fu'>say</span>(!!<span class='no'>what</span>))</div><div class='output co'>#&gt; say(bonjour)</div><div class='input'>
<span class='co'># This also applies to the expressions supplied the user. This is</span>
<span class='co'># like an escape hatch that allows control over the captured</span>
<span class='co'># expression:</span>
<span class='fu'>expr_inputs</span>(<span class='fu'>say</span>(!!<span class='no'>what</span>), !!<span class='no'>what</span>)</div><div class='output co'>#&gt; [[1]]
#&gt; say(bonjour)
#&gt; 
#&gt; [[2]]
#&gt; bonjour
#&gt; </div><div class='input'>

<span class='co'># Finally, you can capture expressions as quosures. A quosure is an</span>
<span class='co'># object that contains both the expression and its environment:</span>
<span class='no'>quo</span> <span class='kw'>&lt;-</span> <span class='fu'>quo</span>(<span class='no'>letters</span>)
<span class='no'>quo</span></div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt;   expr: ^letters
#&gt;   env:  0x7f8290e61c28</div><div class='input'>
<span class='fu'><a href='set_expr.html'>get_expr</a></span>(<span class='no'>quo</span>)</div><div class='output co'>#&gt; letters</div><div class='input'><span class='fu'><a href='get_env.html'>get_env</a></span>(<span class='no'>quo</span>)</div><div class='output co'>#&gt; &lt;environment: 0x7f8290e61c28&gt;</div><div class='input'>
<span class='co'># Quosures can be evaluated with eval_tidy():</span>
<span class='fu'><a href='eval_tidy.html'>eval_tidy</a></span>(<span class='no'>quo</span>)</div><div class='output co'>#&gt;  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
#&gt; [20] "t" "u" "v" "w" "x" "y" "z"</div><div class='input'>
<span class='co'># They have the nice property that you can pass them around from</span>
<span class='co'># context to context (that is, from function to function) and they</span>
<span class='co'># still evaluate in their original environment:</span>
<span class='no'>multiply_expr_by_10</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>expr</span>) {
  <span class='co'># We capture the user expression and its environment:</span>
  <span class='no'>expr</span> <span class='kw'>&lt;-</span> <span class='fu'>enquo</span>(<span class='no'>expr</span>)

  <span class='co'># Then create an object that only exists in this function:</span>
  <span class='no'>local_ten</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>

  <span class='co'># Now let's create a multiplication expression that (a) inlines</span>
  <span class='co'># the user expression as LHS (still wrapped in its quosure) and</span>
  <span class='co'># (b) refers to the local object in the RHS:</span>
  <span class='fu'>quo</span>(!!<span class='no'>expr</span> * <span class='no'>local_ten</span>)
}
<span class='no'>quo</span> <span class='kw'>&lt;-</span> <span class='fu'>multiply_expr_by_10</span>(<span class='fl'>2</span> + <span class='fl'>3</span>)

<span class='co'># The local parts of the quosure are printed in colour if your</span>
<span class='co'># terminal is capable of displaying colours:</span>
<span class='no'>quo</span></div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt;   expr: ^(^2 + 3) * local_ten
#&gt;   env:  0x7f829236b270</div><div class='input'>
<span class='co'># All the quosures in the expression evaluate in their original</span>
<span class='co'># context. The local objects are looked up properly and we get the</span>
<span class='co'># expected result:</span>
<span class='fu'><a href='eval_tidy.html'>eval_tidy</a></span>(<span class='no'>quo</span>)</div><div class='output co'>#&gt; [1] 50</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#user-expressions-versus-your-expressions">User expressions versus your expressions</a></li>

      <li><a href="#capture-raw-expressions">Capture raw expressions</a></li>

      <li><a href="#capture-expressions-in-quosures">Capture expressions in quosures</a></li>

      <li><a href="#quasiquotation">Quasiquotation</a></li>

      <li><a href="#life-cycle">Life cycle</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
